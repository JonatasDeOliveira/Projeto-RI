<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><HTML><HEAD><META http-equiv="Content-Type" content="text/html; charset=utf-8"><META NAME="viewport" CONTENT="width=768"><META HTTP-EQUIV="X-UA-Compatible" CONTENT="IE=edge"><TITLE>A. Arrays Printing @ SPbSU ITMO contest. Petrozavodsk training camp. Winter 2008 @ Timus Online Judge</TITLE><LINK REL="alternate" HREFLANG="x-default" HREF="/problem.aspx?space=52&amp;num=1"><LINK REL="alternate" HREFLANG="en-us" HREF="/problem.aspx?space=52&amp;num=1&amp;locale=en"><LINK REL="alternate" HREFLANG="ru-ru" HREF="/problem.aspx?space=52&amp;num=1&amp;locale=ru"><LINK REL="stylesheet" TYPE="text/css" HREF="/style52.css"><LINK REL="shortcut icon" TYPE="image/x-icon" HREF="/favicon.ico"></HEAD><BODY><TABLE WIDTH="100%" CELLSPACING="0" CELLPADDING="0" CLASS="body"><TR><TD CLASS="caption"><TABLE WIDTH="100%" CELLSPACING="0" CELLPADDING="0"><TR><TD WIDTH="130" CLASS="locale"><A HREF="/problem.aspx?space=52&amp;num=1&amp;locale=en">ENG</A>&nbsp;&nbsp;<A HREF="/problem.aspx?space=52&amp;num=1&amp;locale=ru">RUS</A></TD><TD CLASS="title"><A HREF="/">Timus Online Judge</A></TD><TD WIDTH="130"></TD></TR></TABLE></TD></TR><TR><TD CLASS="panel"><TABLE WIDTH="100%" CELLSPACING="0" CELLPADDING="0"><TR><TD WIDTH="130" VALIGN="TOP" ALIGN="CENTER" STYLE="padding-bottom:5px;"><A HREF="/"><IMG BORDER="0" SRC="/images/usu-summer.jpg" HEIGHT="134" WIDTH="106" ALT=""></A></TD><TD VALIGN="TOP" ALIGN="LEFT"><TABLE WIDTH="100%" CELLSPACING="0" CELLPADDING="0" CLASS="panel"><TR><TH WIDTH="25%"><DIV>Online Judge</DIV></TH><TH WIDTH="25%"><DIV>Problems</DIV></TH><TH WIDTH="25%"><DIV>Authors</DIV></TH><TH WIDTH="25%"><DIV>Online contests</DIV></TH></TR><TR><TD VALIGN="TOP" ALIGN="LEFT"><A HREF="/">About Online Judge</A><BR><A HREF="/help.aspx?topic=faq">Frequently asked questions</A><BR><A HREF="/news.aspx">Site news</A><BR><A HREF="/forum/">Webboard</A><BR><A HREF="/help.aspx?topic=links">Links</A><BR></TD><TD VALIGN="TOP" ALIGN="LEFT"><A HREF="/problemset.aspx">Problem set</A><BR><A HREF="/submit.aspx">Submit solution</A><BR><A HREF="/status.aspx">Judge status</A><BR><A HREF="/help.aspx?topic=judge">Guide</A><BR></TD><TD VALIGN="TOP"><A HREF="/register.aspx">Register</A><BR><A HREF="/authedit.aspx">Update your info</A><BR><A HREF="/ranklist.aspx">Authors ranklist</A><BR><FORM ACTION="/search.aspx" METHOD="GET" STYLE="margin-top:0.6em;"><INPUT NAME="Str" SIZE="12" VALUE="" PLACEHOLDER="Author’s name"> <INPUT TYPE="SUBMIT" VALUE="Search"></FORM></TD><TD VALIGN="TOP"><A HREF="/contest.aspx">Current contest</A><BR><A HREF="/schedule.aspx">Scheduled contests</A><BR><A HREF="/archive.aspx">Past contests</A><BR><A HREF="/help.aspx?topic=contest">Rules</A><BR></TD></TR></TABLE></TD></TR></TABLE></TD></TR><TR><TD STYLE="padding-top: 32px; padding-bottom: 20px;"><H2 CLASS="title">SPbSU ITMO contest. Petrozavodsk training camp. Winter 2008</H2><DIV STYLE="text-align:center; margin-bottom:1em;"><A HREF="/contest.aspx?id=52">About</A> &nbsp; &nbsp; <A HREF="/problemset.aspx?space=52" CLASS="selectedMenu">Problems</A> &nbsp; &nbsp; <A HREF="/submit.aspx?space=52">Submit solution</A> &nbsp; &nbsp; <A HREF="/status.aspx?space=52">Judge status</A> &nbsp; &nbsp; <A HREF="/monitor.aspx?id=52">Standings</A></DIV><DIV STYLE="margin-bottom:1em;"><DIV STYLE="text-align:center; font-weight:bold;">Contest is over</DIV></DIV><TABLE ALIGN="CENTER" CELLSPACING="0" CELLPADDING="0"><TR><TD WIDTH="800"><DIV CLASS="problem_content"><H2 class="problem_title">A. Arrays Printing</H2><DIV class="problem_limits">Time limit: 2.0 second<BR>Memory limit: 64 MB<BR></DIV><DIV ID="problem_text"><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">Java language contains arrays as special classes. Since every class in Java derives from <code>java.lang.Object</code>, every array does, too. An array of objects can contain other arrays as elements. In this problem, we consider only arrays that contain other arrays as elements, or arrays that are empty.</DIV></DIV><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">Sometimes we should print the given array as a string. To do this, we may use the dedicated method, <code>java.util.Arrays.deepToString</code>. This method returns a string representation of the "deep contents" of the specified array. If the array contains other arrays as elements, the string representation contains their contents and so on. This method is designed for converting multidimensional arrays to strings.</DIV></DIV><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">The string representation consists of a list of the array's elements, enclosed in square brackets ("[]"). Adjacent elements are separated by the characters ",&nbsp;" (a comma followed by a space). All the elements are converted to strings by invoking this method recursively.</DIV></DIV><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">For example, we may take the array</DIV></DIV><DIV CLASS="problem_par_pre"><PRE>Object[] A = new Object[2];
A[0] = new Object[0];
A[1] = new Object[0];</PRE></DIV><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">and the invocation of <code>deepToString</code> on it will return <code>[[],&nbsp;[]]</code>.</DIV></DIV><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">Note that a variable of object type in Java is a reference. As a result, an array may contain the same object more than once, and two arrays may contain the same object as an element. So, different arrays may give the same string representation. For example, the array
</DIV></DIV><DIV CLASS="problem_par_pre"><PRE>Object[] B = new Object[2];
B[0] = new Object[0];
B[1] = B[0];</PRE></DIV><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">will have the same string representation as array <code>A</code> has.</DIV></DIV><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">Let's determine the equality relation for array configurations. Two configurations <code>A</code> and <code>B</code> are considered equal if the following statements
<ul>
 <li><code>A[a<sub>1</sub>][a<sub>2</sub>]&hellip;[a<sub>k</sub>] == A[b<sub>1</sub>][b<sub>2</sub>]&hellip;[b<sub>k</sub>]</code></li>
 <li><code>B[a<sub>1</sub>][a<sub>2</sub>]&hellip;[a<sub>k</sub>] == B[b<sub>1</sub>][b<sub>2</sub>]&hellip;[b<sub>k</sub>]</code></li>
</ul>
 are equivalent for all possible sequences of <code>a<sub>i</sub></code> and <code>b<sub>j</sub></code>. Here, the relation "<code>==</code>" should be treated as "equal by reference".</DIV></DIV><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">Given the outcome of the invocation of <code>deepToString</code>, find the number of different array configurations that give the specified result. You may assume that the given string will be a string representation of multidimensional array with constant dimensions created with the construction 
<code>new Object[a<sub>1</sub>][a<sub>2</sub>]&hellip;[a<sub>n</sub>][0]</code>. Here <i>n</i> &le; 100; <i>a</i><sub>1</sub>, &hellip;, <i>a<sub>n</sub></i> are positive integers, <i>a</i><sub>1</sub> &middot; <i>a</i><sub>2</sub> &middot; &hellip; &middot; <i>a<sub>n</sub></i> &le; 512.</DIV></DIV><H3 CLASS="problem_subtitle">Input</H3><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">The input will consist of a single non-empty string <i>S</i> with length not exceeding 10<sup>5</sup>. This string will be an outcome of calling <code>deepToString</code> on an array of the described type.
</DIV></DIV><H3 CLASS="problem_subtitle">Output</H3><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">Output the number of array configurations with the given string representation modulo 10007. 
</DIV></DIV><H3 CLASS="problem_subtitle">Samples</H3><TABLE CLASS="sample"><TR><TH WIDTH="350">input</TH><TH WIDTH="350">output</TH></TR><TR><TD><PRE>[[], []]</PRE></TD><TD><PRE>2</PRE></TD></TR><TR><TD><PRE>[[[[]]]]</PRE></TD><TD><PRE>1</PRE></TD></TR><TR><TD><PRE>[[[]], [[]]]</PRE></TD><TD><PRE>3</PRE></TD></TR></TABLE><H3 CLASS="problem_subtitle">Notes</H3><DIV CLASS="problem_par"><DIV CLASS="problem_par_normal">The arrays in the third example were created by the following statements:

<ol>
<li>
<pre>
third = new Object[2][1][0];
</pre>
</li>

<li>
<pre>
Object level1 = new Object[1][0];
third = new Object[] { level1, level1 };
</pre>
</li>

<li>
<pre>
Object level2 = new Object[0];
third = new Object[] { new Object[] { level2 }, new Object[] { level2 } };
</pre>
</li>
</ol>
</DIV></DIV><DIV CLASS="problem_source"><B>Problem Source: </B>SPbSU ITMO contest. Petrozavodsk training camp. Winter 2008.<BR></DIV></DIV></DIV><DIV CLASS="problem_links"><A HREF="print.aspx?space=52&amp;num=1" TARGET="_blank">Printable version</A><BR></DIV>To submit the solution for this problem go to the Problem set: <A HREF="problem.aspx?space=1&amp;num=1618"><nobr>1618. Arrays Printing</nobr></A></TD></TR></TABLE></TD></TR><TR><TD CLASS="footer"><script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter20918869 = new Ya.Metrika({ id:20918869, clickmap:true, trackLinks:true, accurateTrackBounce:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="https://mc.yandex.ru/watch/20918869" style="position:absolute; left:-9999px;" alt=""></div></noscript>© 2000–2017 <A HREF="/team.aspx">Timus Online Judge Team</A>. All rights reserved.</TD></TR></TABLE></BODY></HTML>