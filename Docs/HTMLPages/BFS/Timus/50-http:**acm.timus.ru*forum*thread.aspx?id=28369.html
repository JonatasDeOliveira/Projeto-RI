<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=768"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Common Board @ Timus Online Judge</title><link rel="alternate" hreflang="x-default" href="/forum/thread.aspx?id=28369"><link rel="alternate" hreflang="en-us" href="/forum/thread.aspx?id=28369&amp;locale=en"><link rel="alternate" hreflang="ru-ru" href="/forum/thread.aspx?id=28369&amp;locale=ru"><link rel="stylesheet" type="text/css" href="/style52.css"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"></head><body><table width="100%" cellspacing="0" cellpadding="0" class="body"><tbody><tr><td class="caption"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td width="130" class="locale"><a href="/forum/thread.aspx?id=28369&amp;locale=en">ENG</a>&nbsp;&nbsp;<a href="/forum/thread.aspx?id=28369&amp;locale=ru">RUS</a></td><td class="title"><a href="/">Timus Online Judge</a></td><td width="130"></td></tr></tbody></table></td></tr><tr><td class="panel"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td width="130" valign="TOP" align="CENTER" style="padding-bottom:5px;"><a href="/"><img border="0" src="/images/usu-summer.jpg" height="134" width="106" alt=""></a></td><td valign="TOP" align="LEFT"><table width="100%" cellspacing="0" cellpadding="0" class="panel"><tbody><tr><th width="25%"><div>Online Judge</div></th><th width="25%"><div>Problems</div></th><th width="25%"><div>Authors</div></th><th width="25%"><div>Online contests</div></th></tr><tr><td valign="TOP" align="LEFT"><a href="/">About Online Judge</a><br><a href="/help.aspx?topic=faq">Frequently asked questions</a><br><a href="/news.aspx">Site news</a><br><a href="/forum/">Webboard</a><br><a href="/help.aspx?topic=links">Links</a><br></td><td valign="TOP" align="LEFT"><a href="/problemset.aspx">Problem set</a><br><a href="/submit.aspx">Submit solution</a><br><a href="/status.aspx">Judge status</a><br><a href="/help.aspx?topic=judge">Guide</a><br></td><td valign="TOP"><a href="/register.aspx">Register</a><br><a href="/authedit.aspx">Update your info</a><br><a href="/ranklist.aspx">Authors ranklist</a><br><form action="/search.aspx" method="GET" style="margin-top:0.6em;"><input name="Str" size="12" value="" placeholder="Author’s name"> <input type="SUBMIT" value="Search"></form></td><td valign="TOP"><a href="/contest.aspx">Current contest</a><br><a href="/schedule.aspx">Scheduled contests</a><br><a href="/archive.aspx">Past contests</a><br><a href="/help.aspx?topic=contest">Rules</a><br></td></tr></tbody></table></td></tr></tbody></table></td></tr><tr><td style="padding-top: 32px; padding-bottom: 20px;"><script type="text/javascript" async="" src="https://mc.yandex.ru/metrika/watch.js"></script><script src="forum.js" type="text/javascript"></script><a href="/forum/">back to board</a><table align="CENTER" cellspacing="0" cellpadding="0"><tbody><tr><td width="960"><h2 class="title">Common Board</h2><div id="ForumBoard"><div style="margin-bottom:1em;"><div class="subject">BigInteger.isProbablePrime</div><div class="board">Posted by <a href="/author.aspx?id=41395" style="font-weight:bold;">...†.†.†...   Stigius   ...†.†.†...</a> 23 Jul 2012 22:45</div><div class="message forum_message_box" style="margin:5px 0;">As many of you know, call to BigInteger.IsProbablePrime in java lead to "Restricted Function" verdict. Today I decided to resolve this problem.<br>When I started reading BigInteger.java, I found that "isProbablePrime" method calls "primeToCertainty" method and passes null as "random" parameter. This null is passed to "passesMillerRabin".<br>"passesMillerRabin" has the following lines of code:<br> <br>if (rnd == null) {<br>&nbsp;&nbsp;&nbsp; rnd = getSecureRandom();<br>}<br> <br>Since "rnd" is actually null, getSecureRandom is called. It has following logic:<br> <br>private static volatile Random staticRandom;<br>private static Random getSecureRandom() {<br>&nbsp;&nbsp;&nbsp; if (staticRandom == null) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; staticRandom = new java.security.SecureRandom();<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; return staticRandom;<br>}<br> <br>That is when called for the first time, it initializes staticRandom with java.security.SecureRandom, in all the following calls - returns cached object.<br>Call to java.security.SecureRandom is the source of all problems. Since it is "secure", it uses a lot of information to initialize, including current time and ip address of machine it is run at. Of course, all attempts to get information about network configuration are blocked, so this caused "Restricted Function" verdict. Moreover, when we tried to allow all required calls, we found out that due to some strange problems such initializing took about five seconds. So we decided to change BigInteger class a bit to use usual Random with some predefined seed instead of SecureRandom. It solved all problems and now isProbablePrime works as it should. Rejudge of all submits that had "Restricted Function" verdict is now in progress and will be finished in few hours.<br> <br>tl;dr: BigInteger.isProbablePrime now works. Be happy.</div><form method="GET" action="post.aspx" style="display:inline;"><input type="HIDDEN" name="id" value="28369"><input type="HIDDEN" name="reply" value="634786803120878510"><input type="SUBMIT" class="forum_button" value="Reply"></form></div><br></div></td></tr></tbody></table></td></tr><tr><td class="footer"><script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter20918869 = new Ya.Metrika({ id:20918869, clickmap:true, trackLinks:true, accurateTrackBounce:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript>&lt;div&gt;&lt;img src="https://mc.yandex.ru/watch/20918869" style="position:absolute; left:-9999px;" alt=""&gt;&lt;/div&gt;</noscript>© 2000–2017 <a href="/team.aspx">Timus Online Judge Team</a>. All rights reserved.</td></tr></tbody></table><img src="https://mc.yandex.ru/metrika/advert.gif" style="position: absolute; visibility: hidden; width: 0px; height: 0px;"></body></html>