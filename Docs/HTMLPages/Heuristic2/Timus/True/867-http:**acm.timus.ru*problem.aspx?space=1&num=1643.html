<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=768"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>1643. Attack of the Dark Fortress @ Timus Online Judge</title><link rel="alternate" hreflang="x-default" href="/problem.aspx?space=1&amp;num=1643"><link rel="alternate" hreflang="en-us" href="/problem.aspx?space=1&amp;num=1643&amp;locale=en"><link rel="alternate" hreflang="ru-ru" href="/problem.aspx?space=1&amp;num=1643&amp;locale=ru"><link rel="stylesheet" type="text/css" href="/style55.css"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"></head><body><table width="100%" cellspacing="0" cellpadding="0" class="body"><tbody><tr><td class="caption"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td width="130" class="locale"><a href="/problem.aspx?space=1&amp;num=1643&amp;locale=en">ENG</a>&nbsp;&nbsp;<a href="/problem.aspx?space=1&amp;num=1643&amp;locale=ru">RUS</a></td><td class="title"><a href="/">Timus Online Judge</a></td><td width="130"></td></tr></tbody></table></td></tr><tr><td class="panel"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td width="130" valign="TOP" align="CENTER" style="padding-bottom:5px;"><a href="/"><img border="0" src="/images/usu-summer.jpg" height="134" width="106" alt=""></a></td><td valign="TOP" align="LEFT"><table width="100%" cellspacing="0" cellpadding="0" class="panel"><tbody><tr><th width="25%"><div>Online Judge</div></th><th width="25%"><div>Problems</div></th><th width="25%"><div>Authors</div></th><th width="25%"><div>Online contests</div></th></tr><tr><td valign="TOP" align="LEFT"><a href="/">About Online Judge</a><br><a href="/help.aspx?topic=faq">Frequently asked questions</a><br><a href="/news.aspx">Site news</a><br><a href="/forum/">Webboard</a><br><a href="/help.aspx?topic=links">Links</a><br></td><td valign="TOP" align="LEFT"><a href="/problemset.aspx">Problem set</a><br><a href="/submit.aspx">Submit solution</a><br><a href="/status.aspx">Judge status</a><br><a href="/help.aspx?topic=judge">Guide</a><br></td><td valign="TOP"><a href="/register.aspx">Register</a><br><a href="/authedit.aspx">Update your info</a><br><a href="/ranklist.aspx">Authors ranklist</a><br><form action="/search.aspx" method="GET" style="margin-top:0.6em;"><input name="Str" size="12" value="" placeholder="Author’s name"> <input type="SUBMIT" value="Search"></form></td><td valign="TOP"><a href="/contest.aspx">Current contest</a><br><a href="/schedule.aspx">Scheduled contests</a><br><a href="/archive.aspx">Past contests</a><br><a href="/help.aspx?topic=contest">Rules</a><br></td></tr></tbody></table></td></tr></tbody></table></td></tr><tr><td style="padding-top: 32px; padding-bottom: 20px;"><table align="CENTER" cellspacing="0" cellpadding="0"><tbody><tr><td width="800"><div class="problem_content"><h2 class="problem_title">1643. Attack of the Dark Fortress</h2><div class="problem_limits">Time limit: 1.0 second<br>Memory limit: 64 MB<br></div><div id="problem_text"><div class="problem_par"><div class="problem_par_normal">Knowing that lich Sandro left to fight the King of Hell, Erathian commanders decided to take advantage
of his absence and take over the Dark Fortress. An army of crusaders led by Catherine Ironfist set out
from Steadwick. On the same day an army of elven snipers led by Gelu set out from the forests of AvLee. The commanders
realize that infantry is vulnerable to liches, and the elven arrows are ineffective against the skeletons,
hence the two armies should unite and attack the Fortress simultaneously. As Sandro may return any moment,
the Fortress should be attacked as soon as possible. As a court cartographer, you are to calculate
the number of days required to implement this plan.</div></div><div class="problem_par"><div class="problem_par_normal">Erathia is divided into square regions. Some of them are passable, some of them are not. On one day, each army can move to one of the adjacent (sharing a vertex with a current region) passable regions. Some of the Erathian passable regions have a teleport of one of 26 types inside. A type of a teleport is indicated by a capital Latin letter. If an army is located in a region with a teleport, it can move
to any region with a teleport of the same type instantly. When two armies are located in the same region, they unite and then start to move as a single army. No army can attack the Fortress (that is, make a move to the region the Fortress is located in) before the union.</div></div><h3 class="problem_subtitle">Input</h3><div class="problem_par"><div class="problem_par_normal">The first line contains space-separated integers <i>n</i> and <i>m</i>&nbsp;— dimensions of the map of Erathia <nobr>(1 ≤ <i>n</i>, <i>m</i> ≤ 100)</nobr>. Then the map itself follows&nbsp;— <i>n</i> lines of <i>m</i> characters each. The meaning of the characters:<br>
'#' indicates impassable region.<br>
'.' indicates passable region.<br>
'A'…'Z' indicates a teleport of type corresponding to that letter.<br>
'$' indicates Catherine's army.<br>
'!' indicates Gelu's army.<br>
'*' indicates the Fortress.<br>
It is guaranteed that the characters '*', '$', '!' are encountered exactly once on the whole map.</div></div><h3 class="problem_subtitle">Output</h3><div class="problem_par"><div class="problem_par_normal">Output a single integer — the number of days that should pass before the united army can attack the Fortress. If the Fortress can't be attacked, output “Impossible”.
</div></div><h3 class="problem_subtitle">Samples</h3><table class="sample"><tbody><tr><th width="350">input</th><th width="350">output</th></tr><tr><td><pre>5 8
....AA.#
.######!
.....*##
.#######
..B$...B</pre></td><td><pre>11</pre></td></tr><tr><td><pre>3 5
##*..
!#...
##..$</pre></td><td><pre>Impossible</pre></td></tr></tbody></table><div class="problem_source"><b>Problem Author: </b>Denis Dublennykh<br><b>Problem Source: </b>USU Junior Contest, October 2008<br></div></div></div><div><b>Tags: </b><a href="problemset.aspx?space=1&amp;tag=graphs">graph theory</a> &nbsp;<span class="problem_tags_toggle">(<form method="POST" action="problem.aspx?space=1&amp;num=1643" style="display:inline;" id="ToggleTagsForm"><a href="problem.aspx?space=1&amp;num=1643" onclick="document.getElementById('ToggleTagsForm').submit();return false;"><input type="hidden" name="Action" value="HideTags">hide tags for unsolved problems</a></form>)</span></div><div class="problem_links"><span>Difficulty: 456</span> &nbsp;&nbsp;&nbsp;<a href="print.aspx?space=1&amp;num=1643" target="_blank">Printable version</a> &nbsp;&nbsp;&nbsp;<a href="submit.aspx?space=1&amp;num=1643">Submit solution</a> &nbsp;&nbsp;&nbsp;<a href="forum/?space=1&amp;num=1643">Discussion (13)</a><br><a href="status.aspx?space=1&amp;num=1643">All submissions (5226)</a> &nbsp;&nbsp;&nbsp;<a href="status.aspx?space=1&amp;num=1643&amp;status=accepted">All accepted submissions (1093)</a> &nbsp;&nbsp;&nbsp;<a href="rating.aspx?space=1&amp;num=1643">Solutions rating (703)</a></div></td></tr></tbody></table></td></tr><tr><td class="footer"><script type="text/javascript" async="" src="https://mc.yandex.ru/metrika/watch.js"></script><script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter20918869 = new Ya.Metrika({ id:20918869, clickmap:true, trackLinks:true, accurateTrackBounce:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript>&lt;div&gt;&lt;img src="https://mc.yandex.ru/watch/20918869" style="position:absolute; left:-9999px;" alt=""&gt;&lt;/div&gt;</noscript>© 2000–2017 <a href="/team.aspx">Timus Online Judge Team</a>. All rights reserved.</td></tr></tbody></table></body></html>