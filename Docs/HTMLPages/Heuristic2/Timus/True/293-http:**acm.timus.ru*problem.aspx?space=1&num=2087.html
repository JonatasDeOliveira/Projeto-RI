<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=768"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>2087. Trains @ Timus Online Judge</title><link rel="alternate" hreflang="x-default" href="/problem.aspx?space=1&amp;num=2087"><link rel="alternate" hreflang="en-us" href="/problem.aspx?space=1&amp;num=2087&amp;locale=en"><link rel="alternate" hreflang="ru-ru" href="/problem.aspx?space=1&amp;num=2087&amp;locale=ru"><link rel="stylesheet" type="text/css" href="/style55.css"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"></head><body><table width="100%" cellspacing="0" cellpadding="0" class="body"><tbody><tr><td class="caption"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td width="130" class="locale"><a href="/problem.aspx?space=1&amp;num=2087&amp;locale=en">ENG</a>&nbsp;&nbsp;<a href="/problem.aspx?space=1&amp;num=2087&amp;locale=ru">RUS</a></td><td class="title"><a href="/">Timus Online Judge</a></td><td width="130"></td></tr></tbody></table></td></tr><tr><td class="panel"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td width="130" valign="TOP" align="CENTER" style="padding-bottom:5px;"><a href="/"><img border="0" src="/images/usu-summer.jpg" height="134" width="106" alt=""></a></td><td valign="TOP" align="LEFT"><table width="100%" cellspacing="0" cellpadding="0" class="panel"><tbody><tr><th width="25%"><div>Online Judge</div></th><th width="25%"><div>Problems</div></th><th width="25%"><div>Authors</div></th><th width="25%"><div>Online contests</div></th></tr><tr><td valign="TOP" align="LEFT"><a href="/">About Online Judge</a><br><a href="/help.aspx?topic=faq">Frequently asked questions</a><br><a href="/news.aspx">Site news</a><br><a href="/forum/">Webboard</a><br><a href="/help.aspx?topic=links">Links</a><br></td><td valign="TOP" align="LEFT"><a href="/problemset.aspx">Problem set</a><br><a href="/submit.aspx">Submit solution</a><br><a href="/status.aspx">Judge status</a><br><a href="/help.aspx?topic=judge">Guide</a><br></td><td valign="TOP"><a href="/register.aspx">Register</a><br><a href="/authedit.aspx">Update your info</a><br><a href="/ranklist.aspx">Authors ranklist</a><br><form action="/search.aspx" method="GET" style="margin-top:0.6em;"><input name="Str" size="12" value="" placeholder="Author’s name"> <input type="SUBMIT" value="Search"></form></td><td valign="TOP"><a href="/contest.aspx">Current contest</a><br><a href="/schedule.aspx">Scheduled contests</a><br><a href="/archive.aspx">Past contests</a><br><a href="/help.aspx?topic=contest">Rules</a><br></td></tr></tbody></table></td></tr></tbody></table></td></tr><tr><td style="padding-top: 32px; padding-bottom: 20px;"><table align="CENTER" cellspacing="0" cellpadding="0"><tbody><tr><td width="800"><div class="problem_content"><h2 class="problem_title">2087. Trains</h2><div class="problem_limits">Time limit: 4.0 second<br>Memory limit: 256 MB<br></div><div id="problem_text"><div class="problem_par"><div class="problem_par_normal">Yulia is not related to Ural ACM, and the reason she is mentioned here is that she has written this task. At the university Yulia preferred mathematics to programming, so her maximum is bubble sorting in Pascal, while at the same time Yulia is an important manager at a large IT company. As every manager, Yulia has meetings. Not all meetings are equally useful, so Yulia appreciates smartphone games that can be played in 1-2 minutes very much.</div></div><div class="problem_par"><div class="problem_par_normal">This is how "Trains" found their place in Yulia’s phone. The game is very simple: the screen shows a railway map, each way ends with a colored station/depot, crossings are equipped with turnouts. One by one, trains leave the only depot. Player has to direct each train to a station of corresponding color, switching the turnouts timely. Just a moment of distraction — and the trains are running all around like colored cockroaches, and you have no idea what to do. So, the game requires tapping the screen with promptness and concentration.</div></div><div class="problem_par"><div class="problem_par_normal">Den noticed the game once, peeking over Yulia’s shoulder. Unlike Yulia, Den is an experienced ACM player, that is why he does not want to just tap the screen, he wants an <b>algorithm</b>. So said so done, after half an hour and three shots of B-52 a bot effectively playing Trains written by Den emerged.</div></div><div class="problem_par"><div class="problem_par_normal">Be like Den! Implement an algorithm for the Trains game. Keep in mind, however, that while Yulia as a manager plans beforehand and switches turnouts in advance, the only thing that motivates Den is the upcoming deadline, so his bot switches the turnout exactly when the train reaches it.</div></div><h3 class="problem_subtitle">Input</h3><div class="problem_par"><div class="problem_par_normal">In the first line two numbers <i>N</i> and <i>M</i> are given (2 ≤ <i>N</i>, <i>M</i> ≤ 500), then 2 × <i>N</i>−1 lines follow containing 2 × <i>M</i>−1 characters each — map description.
Keys on the map are as follows:</div></div><div class="problem_par"><div class="problem_par_normal"><ul>
<li> ’S’ — depot;
</li><li> ’X’ — station;
</li><li> ’F’, ’L’, ’R’ — turnout;
</li><li> ’|’ (vertical bar, decimal ASCII code 124), ’-’ (hyphen, decimal ASCII code 45) — straight segments of the railway;
</li><li> ’.’ (full stop, decimal ASCII code 46) — point outside the railway.
</li></ul></div></div><div class="problem_par"><div class="problem_par_normal">It is guaranteed that the railway network is a tree, with turnouts being represented by internal nodes, depot or stations — by leaves, with only one depot. Tree edges stand for straight-line sections of the network (an edge is one symbol ’|’ or ’-’).</div></div><div class="problem_par"><div class="problem_par_normal">Position of a turnout determines the direction in which a train will follow through, a turnout cannot direct a train to a point outside the railway network. The letter representing a turnout on the map indicates its initial position. ’F’ means that a train having passed the turnout will keep moving forward, ’R’ — will turn right, ’L’ — will turn left.</div></div><div class="problem_par"><div class="problem_par_normal">The next line contains one number <i>Q</i> (1 ≤ <i>Q</i> ≤ 2 × 10<sup>5</sup>) — the number of trains leaving the depot. Each of the following <i>Q</i> lines contains 3 numbers <i>T</i><sub><i>i</i></sub>, <i>X</i><sub><i>i</i></sub>, <i>Y</i><sub><i>i</i></sub> (1 ≤ <i>T</i><sub><i>i</i></sub> ≤ 10<sup>9</sup>, 1 ≤ <i>X</i><sub><i>i</i></sub> ≤ <i>N</i>, 1 ≤ <i>Y</i><sub><i>i</i></sub> ≤ <i>M</i>) — depot departure time for <i>i</i>-th train and destination station coordinates. Trains are ordered by their depot departure time ascending.</div></div><h3 class="problem_subtitle">Output</h3><div class="problem_par"><div class="problem_par_normal">In the first line output a single number <i>R</i> (0 ≤ <i>R</i> ≤ 2 × 10<sup>5</sup>) — the lowest number of required turnout switches.</div></div><div class="problem_par"><div class="problem_par_normal">Each of the following <i>R</i> lines must contain a description of one switch — three numbers <i>T</i><sub><i>i</i></sub>, <i>X</i><sub><i>i</i></sub>, <i>Y</i><sub><i>i</i></sub> and one character <i>C</i><sub><i>i</i></sub> (<i>C</i><sub><i>i</i></sub> ∈ {’F’, ’L’, ’R’}), separated from <i>Y</i><sub><i>i</i></sub> by exactly one space. String <i>T</i><sub><i>i</i></sub> <i>X</i><sub><i>i</i></sub> <i>Y</i><sub><i>i</i></sub> <i>C</i><sub><i>i</i></sub> means that at the moment of time <i>T</i><sub><i>i</i></sub> the turnout situated at (<i>X</i><sub><i>i</i></sub>, <i>Y</i><sub><i>i</i></sub>) is to be switched according to the train direction: ’F’ — forward, ’R’ — right, ’L’ — left. Switching several turnouts at a single moment of time is allowed.</div></div><div class="problem_par"><div class="problem_par_normal">It is guaranteed that there exists at least one solution with the number of switches not exceeding 2 × 10<sup>5</sup>. If several possible solutions exist, output any.</div></div><h3 class="problem_subtitle">Samples</h3><table class="sample"><tbody><tr><th width="350">input</th><th width="350">output</th></tr><tr><td><pre>3 3
S-F-X
..|..
L-R-R
|...|
X.X-R
4
1 1 3
2 3 1
4 1 3
6 3 2
</pre></td><td><pre>4
3 1 2 R
5 1 2 F
7 1 2 R
8 2 2 L
</pre></td></tr><tr><td><pre>2 3
S-F-X
..|..
..X..
3
1 2 2
2 1 3
4 1 3
</pre></td><td><pre>2
2 1 2 R
3 1 2 F
</pre></td></tr></tbody></table><h3 class="problem_subtitle">Notes</h3><div class="problem_par"><div class="problem_par_normal">Let’s look at the second example in more detail. The map contains a depot, two stations, three railway segments, and a turnout. The turnout is initially set in order to direct the train forward. It has two positions: forward and to the right.
At the moment 1 a train starts at the depot. It will pass a distance unit in a time unit and will be at the turnout at the moment 2. In order to reach its destination the train needs to turn right, so the turnout should be switched to the "right" position. Here comes the first switch: 2 1 2 R</div></div><div class="problem_par"><div class="problem_par_normal">At the same moment 2 the second train starts from the depot. It will show up at the turnout at the moment 3, and he will need to pass forward. So the turnout will have to be switched again. Here comes the second switch: 3 1 2 F</div></div><div class="problem_par"><div class="problem_par_normal">The third train will go in the same direction as the second one, so no switch will be required for it.</div></div><div class="problem_source"><b>Problem Author: </b>Denis Mukhametianov<br></div></div></div><div><b>Tags: </b>none &nbsp;<span class="problem_tags_toggle">(<form method="POST" action="problem.aspx?space=1&amp;num=2087" style="display:inline;" id="ToggleTagsForm"><a href="problem.aspx?space=1&amp;num=2087" onclick="document.getElementById('ToggleTagsForm').submit();return false;"><input type="hidden" name="Action" value="HideTags">hide tags for unsolved problems</a></form>)</span></div><div class="problem_links"><span>Difficulty: 3616</span> &nbsp;&nbsp;&nbsp;<a href="print.aspx?space=1&amp;num=2087" target="_blank">Printable version</a> &nbsp;&nbsp;&nbsp;<a href="submit.aspx?space=1&amp;num=2087">Submit solution</a> &nbsp;&nbsp;&nbsp;<a href="forum/?space=1&amp;num=2087">Discussion (1)</a><br><a href="status.aspx?space=1&amp;num=2087">All submissions (101)</a> &nbsp;&nbsp;&nbsp;<a href="status.aspx?space=1&amp;num=2087&amp;status=accepted">All accepted submissions (18)</a> &nbsp;&nbsp;&nbsp;<a href="rating.aspx?space=1&amp;num=2087">Solutions rating (15)</a></div></td></tr></tbody></table></td></tr><tr><td class="footer"><script type="text/javascript" async="" src="https://mc.yandex.ru/metrika/watch.js"></script><script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter20918869 = new Ya.Metrika({ id:20918869, clickmap:true, trackLinks:true, accurateTrackBounce:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript>&lt;div&gt;&lt;img src="https://mc.yandex.ru/watch/20918869" style="position:absolute; left:-9999px;" alt=""&gt;&lt;/div&gt;</noscript>© 2000–2017 <a href="/team.aspx">Timus Online Judge Team</a>. All rights reserved.</td></tr></tbody></table></body></html>